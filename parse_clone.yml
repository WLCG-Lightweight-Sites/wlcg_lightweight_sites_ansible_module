---
 - hosts: owncomp
   tasks:
    - include_vars:
        file: complete_config.yaml
        name: config           

    - add_host:
        name: "{{ item['ip_address'] }}"
        groups: webservers
        ansible_user: root
      with_items: "{{ config['site_infrastructure'] }}"

 - hosts: webservers
   tasks:
    - include_vars:
        file: complete_config.yaml
        name: config

    - yum:
        name: git
        name: python-setuptools

    - easy_install:
        name: pip

    - pip:
        name: docker-py

    - git:
        repo: "{{ item['repository_url'] }}"
        dest: /home/repo
      with_items: "{{ config['lightweight_components'] }}"

    - yum:
        name: docker

    - service:
        name: docker
        state: started

    - docker_image:
        name: maany/lightweight-site-ce
        state: present


